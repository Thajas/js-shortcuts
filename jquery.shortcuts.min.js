(function(d){var n={backspace:8,tab:9,enter:13,pause:19,capslock:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,"?":191},e={},h={},i=false,j,k=function(a,b){var c="";c+=a;if(b.ctrl)c+="_ctrl";if(b.alt)c+="_alt";if(b.shift)c+="_shift";if(b.which&&b.which!==16&&b.which!==17&&b.which!==18)c+="_"+b.which;return c},m=function(a){var b={};a=a.toLowerCase().replace(/\s+/g, "").split(/\+/);for(var c,g=0,f=a.length;g<f;g+=1){c=a[g];if(c==="ctrl"||c==="alt"||c==="shift")b[c]=true;else b.which=n[c]||c.toUpperCase().charCodeAt()}return b},o=function(a){var b=a.tagName.toLowerCase();a=a.type;return b==="input"&&(a==="text"||a==="password"||a==="file"||a==="search")||b==="textarea"?true:false},l=function(a,b){if(j){var c={ctrl:b.ctrlKey,alt:b.altKey,shift:b.shiftKey,which:b.which},g=o(b.target);a=k(a,c);a=j[a];c=false;if(a&&a.length>0)for(var f=0,p=a.length;f<p;f+=1)if(!g|| a[f].enableInInput){if(!c){b.preventDefault();c=true}a[f].handler(b)}}};d.Shortcuts={};d.Shortcuts.start=function(a){a=a||"default";j=e[a];if(!i){d(document).bind((d.browser.opera?"keypress":"keydown")+".shortcuts",function(b){if(b.type==="keypress"&&b.which>=97&&b.which<=122)b.which-=32;h[b.which]||l("down",b);h[b.which]=true;l("hold",b)});d(document).bind("keyup.shortcuts",function(b){h[b.which]=false;l("up",b)});i=true}};d.Shortcuts.stop=function(){d(document).unbind("keypress.shortcuts keydown.shortcuts keyup.shortcuts"); i=false};d.Shortcuts.add=function(a){if(!a.mask)throw new Error("$.Shortcuts.add: required parameter 'params.mask' is undefined.");if(!a.handler)throw new Error("$.Shortcuts.add: required parameter 'params.handler' is undefined.");a.type=a.type||"down";a.list=a.list||"default";var b=m(a.mask);b=k(a.type,b);e[a.list]||(e[a.list]={});var c=e[a.list];c[b]||(c[b]=[]);c[b].push(a)};d.Shortcuts.remove=function(a){if(!a.mask)throw new Error("$.Shortcuts.remove: required parameter 'params.mask' is undefined."); a.type=a.type||"down";a.list=a.list||"default";if(e[a.list]){var b=m(a.mask);b=k(a.type,b);delete e[a.list][b]}}})(jQuery);